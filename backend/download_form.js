import{d as C,v as u,x as c,y as i,M as g,J as M,P as R,Q as y,R as k,z as m,S as T,G as $,H as F,r as p,m as I}from"./B-QMnIrG.js";import{_ as P}from"./DlAUqK2U.js";const B=C({name:"DownloadForm",props:{placeholder:{type:String,default:"Paste a Social Media Video URL"},buttonText:{type:String,default:"Download"},loadingText:{type:String,default:"Extracting..."},hint:{type:String,default:""},copyright:{type:String,default:""},errorMessage:{type:String,default:"Please enter a supported social media URL to download the video."},supportedDomains:{type:Array,default:()=>["youtube.com","youtu.be","tiktok.com","instagram.com","facebook.com","fb.com","fb.watch","twitter.com","x.com","snapchat.com","bilibili.com","xiaohongshu.com","xhslink.com","kwai.com","kuaishou.com","kw.ai","threads.com","vk.com","pinterest.com","pin.it","douyin.com",""]}},setup(o,{emit:s}){const d=p(""),l=p(!1),h=p(!1),v=p(!1),a=p({title:"",imageUrl:"",duration:"",formats:[]}),_=I(),b=()=>{l.value=!1},U=()=>{d.value&&(l.value=!1,s("input",d.value))},E=t=>{if(!t)return!1;console.log("Validating URL:",t);const e=o.supportedDomains.some(r=>t.toLowerCase().includes(r));return console.log("URL is valid:",e),e},D=t=>{if(!t)return"";const e=Math.floor(parseFloat(t)),r=Math.floor(e/60),n=e%60;return`${r}:${n<10?"0"+n:n}`},S=async()=>{if(!d.value||!E(d.value)){l.value=!0,h.value=!1;return}v.value=!0,l.value=!1;try{const t=_.public.API_BASE_URL,e={"Content-Type":"application/json"},r=await fetch(`${t}/ikool/media/download`,{method:"POST",headers:e,body:JSON.stringify({url:d.value})});if(!r.ok)throw new Error("Failed to fetch video data");const n=await r.json();console.log("download响应结果为:",n),n.code==="0000"&&n.data?(V(n.data),h.value=!0,s("success",n.data)):(console.error("API error:",n.msg||"Unknown error"),l.value=!0,h.value=!1,s("error",n.msg||"Unknown error"))}catch(t){console.error("Error fetching video data:",t),l.value=!0,h.value=!1,s("error",t.message)}finally{v.value=!1}},V=t=>{const e=t.title||"",r=t.imageUrl||"",n=t.duration||"",f=[];t.medias&&t.medias.length>0&&t.medias.forEach(w=>{f.push({quality:w.format||"Video (.MP4)",url:w.url,fileSize:w.fileSize,type:"video"})}),a.value={title:e,imageUrl:r,duration:n,formats:f},!r&&f.length>0&&L(f[0].url)},L=t=>{const e=document.createElement("video");e.crossOrigin="anonymous",e.src=t,e.addEventListener("loadedmetadata",()=>{if(!a.value.duration){const r=Math.floor(e.duration/60),n=Math.floor(e.duration%60);a.value.duration=`${r}:${n<10?"0"+n:n}`}e.currentTime=.1}),e.addEventListener("seeked",()=>{try{const r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight,r.getContext("2d").drawImage(e,0,0,r.width,r.height);const f=r.toDataURL("image/jpeg");a.value.imageUrl=f}catch(r){console.error("Error generating thumbnail:",r),a.value.imageUrl="/thumbnail.svg"}}),e.addEventListener("error",()=>{console.error("Error loading video for thumbnail"),a.value.imageUrl="/thumbnail.svg"}),e.load()};return{localVideoUrl:d,showError:l,showVideoResult:h,isLoading:v,videoData:a,clearError:b,handleUrlInput:U,handleDownload:S,downloadFormat:t=>{if(t.url){const e=document.createElement("a");e.href=t.url,e.rel="noreferrer",e.target="_blank",e.referrerPolicy="no-referrer",document.body.appendChild(e),e.click(),setTimeout(()=>{document.body.removeChild(e)},100)}},formatDuration:D}}}),A={class:"download-form"},j={class:"download-form__input-wrapper"},q=["placeholder"],z=["disabled"],N={key:0,class:"download-form__error"},O={key:1,class:"download-form__hint"},H={key:2,class:"download-form__copyright"},J={key:3,class:"video-result"},G={class:"video-result__content"},Q={class:"video-result__thumbnail"},W=["src"],K={class:"video-result__duration"},X={class:"video-result__info"},Y={class:"video-result__title"},Z={class:"video-result__formats"},x={class:"video-result__quality"},oo=["onClick"];function eo(o,s,d,l,h,v){return c(),u("div",A,[i("div",j,[M(i("input",{type:"text",class:"download-form__input",placeholder:o.placeholder,"onUpdate:modelValue":s[0]||(s[0]=a=>o.localVideoUrl=a),onFocus:s[1]||(s[1]=(...a)=>("clearError"in o?o.clearError:y(k))&&("clearError"in o?o.clearError:y(k))(...a)),onInput:s[2]||(s[2]=(...a)=>o.handleUrlInput&&o.handleUrlInput(...a))},null,40,q),[[R,o.localVideoUrl]]),i("button",{class:"btn btn--primary download-form__button",onClick:s[3]||(s[3]=(...a)=>o.handleDownload&&o.handleDownload(...a)),disabled:o.isLoading},m(o.isLoading?o.loadingText:o.buttonText),9,z)]),("showError"in o?o.showError:y(T))?(c(),u("p",N,m(o.errorMessage),1)):g("",!0),o.hint?(c(),u("p",O,m(o.hint),1)):g("",!0),o.copyright?(c(),u("p",H,m(o.copyright),1)):g("",!0),o.showVideoResult?(c(),u("div",J,[i("div",G,[i("div",Q,[i("img",{src:o.videoData.imageUrl,alt:"Video thumbnail",referrerpolicy:"no-referrer"},null,8,W),i("span",K,m(o.formatDuration(o.videoData.duration)),1)]),i("div",X,[i("h3",Y,m(o.videoData.title),1),i("div",Z,[(c(!0),u($,null,F(o.videoData.formats,(a,_)=>(c(),u("div",{class:"video-result__format",key:_},[i("span",x,m(a.quality),1),i("button",{class:"btn btn--outline video-result__download",onClick:b=>o.downloadFormat(a)}," Download ",8,oo)]))),128))])])])])):g("",!0)])}const no=P(B,[["render",eo],["__scopeId","data-v-e2a99a49"]]);export{no as _};
